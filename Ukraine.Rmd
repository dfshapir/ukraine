---
title: "Ukraine"
author: "Daniel Shapiro"
date: "4/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(scipen=999)
library(tidyverse)
library(readr)
library(readxl)
library(cowplot)
library(stargazer)
```

```{r}
Totals <- read_xlsx("Totals.xlsx")
```

```{r pct graph}
pct <- Totals %>%
  mutate(`No Mask` = `No Mask`/`Total` * 100) %>%
  mutate(`Mask Covers Nothing` = `Mask Covers Nothing`/`Total` * 100) %>%
  mutate(`Mask Covers Mouth` = `Mask Covers Mouth`/`Total` * 100) %>%
  mutate(`Full Mask` = `Full Mask`/`Total` * 100)

pct <- pivot_longer(pct, cols = c(`No Mask`, `Mask Covers Nothing`, `Mask Covers Mouth`, `Full Mask`)) %>%
  rename(Percentage = value) %>%
  rename(`Level of Adherence` = name)

region <- ggplot(pct, aes(x = Region, y = Percentage, fill = `Level of Adherence`)) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values = c("light green", "yellow", "orange", "red")) +
  labs(title = "Mask Wearing By Region")

region

ggsave("region.png")
```

```{r hdi}
City <- read_xlsx("City Data.xlsx")
```

```{r hdireal}
City2 <- City %>%

# Filter to get only full mask
  
  filter(Category == "Full Mask") %>%

# Multiply HDI by 100 for readability purposes
  
  mutate(`2019 Oblast HDI` = `2019 Oblast HDI` * 100)
```

```{r regression, results = 'asis'}
hdireg <- lm(Percentage ~ `2019 Oblast HDI` + `Total Ukr Cases` + `Not Oblast Center` + `2001 Pct Russian`, data = City2)

summary(hdireg)

stargazer(hdireg, title = "Impact of City-Specific Factors on Percent Full Mask Wearing", type = "html")
```

```{r graphs, warning = FALSE}
City3 <- City %>%
  filter(Category == "Full Mask") %>%
  filter(City != "Bilhorod-Dnistrovskyi")

ggplot(City3, aes(x = `2019 Oblast HDI`, y = Percentage)) +
  geom_point(aes(size = `2020 City Population`)) +
  geom_smooth(method = "lm", se = TRUE) +
  geom_text(aes(label = City, hjust = .4, vjust = -1.1), size = 3) +
  labs(title = "Relationship Between Oblast HDI and Percent Full Masking",
       subtitle = "Point Size is Relative to City Size") +
  theme(legend.position = "none")

ggplot(City3, aes(x = `Total Ukr Cases`, y = Percentage)) +
  geom_point(aes(size = `2020 City Population`)) +
  geom_smooth(method = "lm", se = TRUE) +
  geom_text(aes(label = City, hjust = .4, vjust = -1.1), size = 3) +
  labs(title = "Relationship Between Total Ukrainian Cases and Percent Full Masking",
       subtitle = "Point Size is Relative to City Size") +
  theme(legend.position = "none") 

ggplot(City3, aes(x = `2001 Pct Russian`, y = Percentage)) +
  geom_point(aes(size = `2020 City Population`)) +
  geom_smooth(method = "lm", se = TRUE) +
  geom_text(aes(label = City, hjust = .45, vjust = -1), size = 3) +
  labs(title = "Relationship Between Pct. of Native Russian Speakers and Pct. Full Masking",
       subtitle = "Point Size is Relative to City Size, Data is From 2001") +
  theme(legend.position = "none")
```

